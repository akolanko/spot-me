{% extends 'base.html' %}
{% block content %}
	<div class='content'>
		<div class='block account'>
			<div class='heading-columns'>
				<h1 class='page-block-title'>Account</h2>
			</div>
			<div class='left'>
				<div class='account-info' id='account-main'>
					<div class='account-field'>
						<div class='label'>
							Name
						</div>
						<div class='field'>
							{{ user.fname }} {{ user.lname }}
						</div>
					</div>
					<div class='account-field'>
						<div class='label'>
							Username
						</div>
						<div class='field'>
							{{ user.username }}
						</div>
					</div>
					<div class='account-field'>
						<div class='label'>
							Email
						</div>
						<div class='field'>
							{{ user.email }}
						</div>
					</div>
					<div class='account-field'>
						<div class='label'>
							Birthday
						</div>
						<div class='field'>
							{{ user.birthday.strftime('%B %e, %Y') }}
						</div>
					</div>
				</div>
				<div class='account-info' id='account-form'>
					<form id='update-account-form' action="" method="post">
						{{ accform.hidden_tag() }}
						<div class='account-field'>
							<div class='label'>
								Name
							</div>
							<div class='field field-inline'>
								{{ accform.fname(value=user.fname) }}
							</div>
							<div class='field field-inline'>
								{{ accform.lname(value=user.lname) }}
							</div>
							<div class='error-container'>
								{% for error in accform.fname.errors %}
									<div class="validation-error">{{ error }}</div>
								{% endfor %}
							</div>
							<div class='error-container'>
								{% for error in accform.lname.errors %}
									<div class="validation-error">{{ error }}</div>
								{% endfor %}
							</div>
						</div>
						<div class='account-field'>
							<div class='label'>
								Username
							</div>
							<div class='field'>
								{{ accform.username(value=user.username) }}
							</div>
							<div class='error-container'>
								{% for error in accform.username.errors %}
									<div class="validation-error">{{ error }}</div>
								{% endfor %}
							</div>
						</div>
						<div class='account-field'>
							<div class='label'>
								Email
							</div>
							<div class='field'>
								{{ accform.email(value=user.email) }}
							</div>
							<div class='error-container'>
								{% for error in accform.email.errors %}
									<div class="validation-error">{{ error }}</div>
								{% endfor %}
							</div>
						</div>
						<div class='account-field'>
							<div class='label'>
								Birthday
							</div>
							<div class='field'>
								{{ accform.birthday(value=user.birthday.strftime('%B %e, %Y')) }}
							</div>
							<div class='error-container'>
								{% for error in accform.birthday.errors %}
									<div class="validation-error">{{ error }}</div>
								{% endfor %}
							</div>
						</div>
						<div class='account-buttons' id='account-btns-update'>
							{{ accform.submit(id='update-account-submit', value="Update", class='button button-1', id='account-update-btn') }}
							<button class='button button-4'>Delete Account</button>
						</div>
					</form>
				</div>
				<div class='account-buttons' id='account-btns-main'>
					<button class='button button-1' id='edit-account-btn'>Edit</button>
					<button class='button button-4'>Delete Account</button>
				</div>
			</div>
			<div class='right'>
				<h2 class='block-title'>Change Password</h2>
				<div class='update-password'>
					<form id='update-password-form' action="" method="post">
						{{ pswform.hidden_tag() }}
						<div class='form-field'>
							{{ pswform.password(placeholder="new password") }}
							<div class='error-container'>
								{% for error in pswform.password.errors %}
									<div class="validation-error">{{ error }}</div>
								{% endfor %}
							</div>
						</div>
						<div class='form-field'>
							{{ pswform.password_repeat(placeholder="repeat password") }}
							<div class='error-container'>
								{% for error in pswform.password_repeat.errors %}
									<div class="validation-error">{{ error }}</div>
								{% endfor %}
							</div>
						</div>
						{{ pswform.submit(id='update-password-submit', value="Update", class='button button-1', id='password-update-btn') }}
					</form>
				</div>
			</div>
		</div>
	</div>
{% endblock %}
{% block javascript %}
<script type='text/javascript'>
	$(document).ready(function() {
		$('#update-password-form').submit(function (e) {
			var url = "{{ url_for('update_password') }}";
			$.ajax({
				type: "POST",
				url: url,
				data: $('#update-password-form').serialize(),
				success: function(data) {
					if(typeof data == "string"){
						$('#flash-container').html("<ul class='flash-list'><li class='flash-item'>" + data + "</li></ul>");
						$('.flash-list').delay(1500).slideUp();
						$("#update-password-form input[type='password']").val('');
						$(".error-container").empty();
					} else {
						for (var key in data){
							var value = data[key];
							var err = $("#"+key).next();
							err.html("<div class='validation-error'>" + value + "</div>");
						}
						console.log(data);
					}
				}
			});
			e.preventDefault();
		});

		$.ajaxSetup({
			beforeSend: function(xhr, settings) {
				if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
					xhr.setRequestHeader("X-CSRFToken", "{{ pswform.csrf_token._value() }}");
				}
			}
		});

		$('#update-account-form').submit(function (e) {
			var url = "{{ url_for('update_account') }}";
			$.ajax({
				type: "POST",
				url: url,
				data: $('#update-account-form').serialize(),
				success: function(data) {
					console.log(data);
				}
			});
			e.preventDefault();
		});
	});
</script>
{% endblock %}